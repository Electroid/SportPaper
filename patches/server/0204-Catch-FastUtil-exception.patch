From 8a5b5250ee9128c8fe1bb8c7b4a3a473ebb91fb3 Mon Sep 17 00:00:00 2001
From: linsaftw <linsaftw@users.noreply.github.com>
Date: Tue, 27 Apr 2021 09:53:13 -0300
Subject: [PATCH] Catch FastUtil exception


diff --git a/src/main/java/net/minecraft/server/ChunkProviderServer.java b/src/main/java/net/minecraft/server/ChunkProviderServer.java
index e58c022b..e45372b3 100644
--- a/src/main/java/net/minecraft/server/ChunkProviderServer.java
+++ b/src/main/java/net/minecraft/server/ChunkProviderServer.java
@@ -442,12 +442,16 @@ public class ChunkProviderServer implements IChunkProvider {
             // SportPaper start
             LongIterator iterator = unloadQueue.iterator();
             for (int i = 0; i < 100 && iterator.hasNext(); ++i) {
-                long chunkcoordinates = iterator.nextLong();
-                iterator.remove();
-                // SportPaper end
-                Chunk chunk = this.chunks.get(chunkcoordinates);
-                if (chunk == null) continue;
-                unloadChunk(chunk, true); // SportPaper - Move to own method
+                try {
+                    long chunkcoordinates = iterator.nextLong();
+                    iterator.remove();
+                    // SportPaper end
+                    Chunk chunk = this.chunks.get(chunkcoordinates);
+                    if (chunk == null) continue;
+                    unloadChunk(chunk, true); // SportPaper - Move to own method
+                } catch (Exception e) {
+                    // SportPaper - Catch possible NPEs (Concurrent modification?)
+                }
             }
             // CraftBukkit end
 
-- 
2.31.1

