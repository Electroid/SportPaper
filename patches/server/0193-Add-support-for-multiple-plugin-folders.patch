From c84f7bd0ff1f370f643d4df2a7815186220e48d2 Mon Sep 17 00:00:00 2001
From: VytskaLT <VytskaLT@protonmail.com>
Date: Tue, 15 Dec 2020 21:51:54 +0200
Subject: [PATCH] Add support for multiple plugin folders


diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index 613582cc..8402de7a 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -232,22 +232,18 @@ public final class CraftServer implements Server {
     public void loadPlugins() {
         pluginManager.registerInterface(JavaPluginLoader.class);
 
-        File pluginFolder = (File) console.options.valueOf("plugins");
+        List<File> pluginFolders = (List<File>) console.options.valuesOf("plugins");
 
-        if (pluginFolder.exists()) {
-            Plugin[] plugins = pluginManager.loadPlugins(pluginFolder);
-            for (Plugin plugin : plugins) {
-                try {
-                    String message = String.format("Loading %s", plugin.getDescription().getFullName());
-                    plugin.getLogger().info(message);
-                    plugin.onLoad();
-                } catch (Throwable ex) {
-                    Logger.getLogger(CraftServer.class.getName()).log(Level.SEVERE, ex.getMessage() + " initializing " + plugin.getDescription().getFullName() + " (Is it up to date?)", ex);
-                    pluginFailedToLoad(plugin);
-                }
+        Plugin[] plugins = pluginManager.loadPlugins(pluginFolders);
+        for (Plugin plugin : plugins) {
+            try {
+                String message = String.format("Loading %s", plugin.getDescription().getFullName());
+                plugin.getLogger().info(message);
+                plugin.onLoad();
+            } catch (Throwable ex) {
+                Logger.getLogger(CraftServer.class.getName()).log(Level.SEVERE, ex.getMessage() + " initializing " + plugin.getDescription().getFullName() + " (Is it up to date?)", ex);
+                pluginFailedToLoad(plugin);
             }
-        } else {
-            pluginFolder.mkdir();
         }
     }
 
diff --git a/src/main/java/org/bukkit/craftbukkit/Main.java b/src/main/java/org/bukkit/craftbukkit/Main.java
index d1ce7a86..d75d12cf 100644
--- a/src/main/java/org/bukkit/craftbukkit/Main.java
+++ b/src/main/java/org/bukkit/craftbukkit/Main.java
@@ -32,6 +32,7 @@ public class Main {
                         .withRequiredArg()
                         .ofType(File.class)
                         .defaultsTo(new File("plugins"))
+                        .withValuesSeparatedBy(';')
                         .describedAs("Plugin directory");
 
                 acceptsAll(asList("h", "host", "server-ip"), "Host to listen on")
-- 
2.25.1

